<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/ARCHITECTURE_DIAGRAM.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/ARCHITECTURE_DIAGRAM.md" />
              <option name="updatedContent" value="# Location Feature - Architecture Diagram&#10;&#10;```&#10;┌─────────────────────────────────────────────────────────────────────┐&#10;│                          USER INTERFACE                              │&#10;├─────────────────────────────────────────────────────────────────────┤&#10;│                                                                       │&#10;│  ItemScreen.kt                                                        │&#10;│  ┌─────────────────────────────────────────────────────────────┐   │&#10;│  │  • Name TextField                                            │   │&#10;│  │  • Number of Players TextField                              │   │&#10;│  │  • Date Picker                                               │   │&#10;│  │  • Family Friendly RadioButton                              │   │&#10;│  │  ┌──────────────────────────────────────────────────────┐   │   │&#10;│  │  │  LOCATION SECTION                                     │   │   │&#10;│  │  │  ┌────────────────────────────────────────────────┐  │   │   │&#10;│  │  │  │  MyLocation Component                          │  │   │   │&#10;│  │  │  │  ┌──────────────────────────────────────────┐  │  │   │   │&#10;│  │  │  │  │  RequirePermissions                      │  │  │   │   │&#10;│  │  │  │  │  ├─ Request if not granted               │  │  │   │   │&#10;│  │  │  │  │  └─ Show permission UI                   │  │  │   │   │&#10;│  │  │  │  └──────────────────────────────────────────┘  │  │   │   │&#10;│  │  │  │  ┌──────────────────────────────────────────┐  │  │   │   │&#10;│  │  │  │  │  MyLocationViewModel                     │  │  │   │   │&#10;│  │  │  │  │  ├─ Monitors LocationMonitor             │  │  │   │   │&#10;│  │  │  │  │  └─ Provides current location            │  │  │   │   │&#10;│  │  │  │  └──────────────────────────────────────────┘  │  │   │   │&#10;│  │  │  │  ┌──────────────────────────────────────────┐  │  │   │   │&#10;│  │  │  │  │  MyMap (Interactive Google Map)          │  │  │   │   │&#10;│  │  │  │  │  ├─ Draggable marker                     │  │  │   │   │&#10;│  │  │  │  │  ├─ Tap to select location               │  │  │   │   │&#10;│  │  │  │  │  ├─ Long-press to select                 │  │  │   │   │&#10;│  │  │  │  │  └─ Callback: onLocationSelected()       │  │  │   │   │&#10;│  │  │  │  └──────────────────────────────────────────┘  │  │   │   │&#10;│  │  │  └────────────────────────────────────────────────┘  │   │   │&#10;│  │  └──────────────────────────────────────────────────────┘   │   │&#10;│  │  • Save Button (sends latitude/longitude)                   │   │&#10;│  └─────────────────────────────────────────────────────────────┘   │&#10;│                          ↓                                           │&#10;└───────────────────────────┼──────────────────────────────────────────┘&#10;                            │&#10;┌───────────────────────────┼──────────────────────────────────────────┐&#10;│                          ↓                                            │&#10;│                   ItemViewModel.kt                                    │&#10;│  ┌─────────────────────────────────────────────────────────────┐    │&#10;│  │  saveOrUpdateItem(                                           │    │&#10;│  │    name, nr_players, date, family_friendly,                 │    │&#10;│  │    latitude, longitude  ← NEW PARAMETERS                    │    │&#10;│  │  )                                                            │    │&#10;│  └─────────────────────────────────────────────────────────────┘    │&#10;│                          ↓                                            │&#10;└───────────────────────────┼──────────────────────────────────────────┘&#10;                            │&#10;┌───────────────────────────┼──────────────────────────────────────────┐&#10;│                          ↓                                            │&#10;│                   ItemRepository.kt                                   │&#10;│  ┌─────────────────────────────────────────────────────────────┐    │&#10;│  │  save(item) / update(item)                                   │    │&#10;│  │  • Sends to server API (POST/PUT)                           │    │&#10;│  │  • Saves to local database                                   │    │&#10;│  └─────────────────────────────────────────────────────────────┘    │&#10;│               ↓                              ↓                        │&#10;└───────────────┼──────────────────────────────┼───────────────────────┘&#10;                │                              │&#10;     ┌──────────┴──────────┐      ┌───────────┴──────────┐&#10;     │                     │      │                        │&#10;┌────▼────────────────────┐│  ┌───▼──────────────────────┐│&#10;│  ItemService.kt         ││  │  AppDatabase.kt          ││&#10;│  (Retrofit API)         ││  │  (Room Database)         ││&#10;├─────────────────────────┤│  ├──────────────────────────┤│&#10;│ POST /api/boardgames    ││  │  items table             ││&#10;│ {                       ││  │  ┌────────────────────┐  ││&#10;│   &quot;name&quot;: &quot;...&quot;,        ││  │  │ _id (String)       │  ││&#10;│   &quot;nr_players&quot;: 4,      ││  │  │ name (String)      │  ││&#10;│   &quot;date&quot;: &quot;...&quot;,        ││  │  │ nr_players (Int)   │  ││&#10;│   &quot;family_friendly&quot;: T  ││  │  │ date (String)      │  ││&#10;│   &quot;latitude&quot;: 46.77,    ││  │  │ family_friendly    │  ││&#10;│   &quot;longitude&quot;: 23.62    ││  │  │ version (Int)      │  ││&#10;│ }                       ││  │  │ needsSync (Bool)   │  ││&#10;└─────────────────────────┘│  │  │ latitude (Double?) │← NEW&#10;                           │  │  │ longitude(Double?) │← NEW&#10;                           │  │  └────────────────────┘  ││&#10;                           │  └──────────────────────────┘│&#10;                           │                              │&#10;                           │  Migration v1 → v2:          │&#10;                           │  ALTER TABLE items           │&#10;                           │    ADD COLUMN latitude REAL  │&#10;                           │  ALTER TABLE items           │&#10;                           │    ADD COLUMN longitude REAL │&#10;                           └──────────────────────────────┘&#10;&#10;┌─────────────────────────────────────────────────────────────────────┐&#10;│                        LOCATION SERVICES                             │&#10;├─────────────────────────────────────────────────────────────────────┤&#10;│                                                                       │&#10;│  LocationMonitor.kt                                                   │&#10;│  ┌─────────────────────────────────────────────────────────────┐   │&#10;│  │  • Uses FusedLocationProviderClient                          │   │&#10;│  │  • Gets last known location                                  │   │&#10;│  │  • Subscribes to location updates                            │   │&#10;│  │  • Emits Flow&lt;Location?&gt;                                     │   │&#10;│  └─────────────────────────────────────────────────────────────┘   │&#10;│                          ↓                                            │&#10;│  RequirePermissions.kt                                                │&#10;│  ┌─────────────────────────────────────────────────────────────┐   │&#10;│  │  • Checks ACCESS_FINE_LOCATION                               │   │&#10;│  │  • Checks ACCESS_COARSE_LOCATION                             │   │&#10;│  │  • Shows permission request UI                               │   │&#10;│  │  • Handles permission results                                │   │&#10;│  └─────────────────────────────────────────────────────────────┘   │&#10;│                          ↓                                            │&#10;│  AndroidManifest.xml                                                  │&#10;│  ┌─────────────────────────────────────────────────────────────┐   │&#10;│  │  &lt;uses-permission ACCESS_FINE_LOCATION /&gt;                    │   │&#10;│  │  &lt;uses-permission ACCESS_COARSE_LOCATION /&gt;                  │   │&#10;│  │  &lt;meta-data MAPS_API_KEY /&gt;                                  │   │&#10;│  └─────────────────────────────────────────────────────────────┘   │&#10;└─────────────────────────────────────────────────────────────────────┘&#10;```&#10;&#10;## Data Flow&#10;&#10;### Adding New Item&#10;```&#10;User Opens Add Screen&#10;    ↓&#10;Permissions Check&#10;    ↓ (granted)&#10;Location Service Starts&#10;    ↓&#10;Gets Current Location (46.77, 23.62)&#10;    ↓&#10;Map Displays with Marker at Current Location&#10;    ↓&#10;User Drags Marker to (46.80, 23.65)&#10;    ↓&#10;onLocationSelected(46.80, 23.65) called&#10;    ↓&#10;State Updated: latitude=46.80, longitude=23.65&#10;    ↓&#10;User Taps Save&#10;    ↓&#10;ItemViewModel.saveOrUpdateItem(..., 46.80, 23.65)&#10;    ↓&#10;ItemRepository.save(item)&#10;    ↓&#10;├─ POST to Server API (online)&#10;│  └─ {latitude: 46.80, longitude: 23.65}&#10;└─ Save to Local Database&#10;   └─ INSERT INTO items (..., latitude, longitude)&#10;```&#10;&#10;### Editing Existing Item&#10;```&#10;User Opens Edit Screen (itemId=&quot;123&quot;)&#10;    ↓&#10;ItemViewModel.loadItem()&#10;    ↓&#10;Load from Database/Server&#10;    ↓&#10;Item has latitude=46.77, longitude=23.62&#10;    ↓&#10;State Initialized: latitude=46.77, longitude=23.62&#10;    ↓&#10;Map Displays with Marker at Saved Location (46.77, 23.62)&#10;    ↓&#10;User Moves Marker to (46.80, 23.65)&#10;    ↓&#10;State Updated: latitude=46.80, longitude=23.65&#10;    ↓&#10;User Taps Save&#10;    ↓&#10;ItemViewModel.saveOrUpdateItem(..., 46.80, 23.65)&#10;    ↓&#10;ItemRepository.update(item)&#10;    ↓&#10;├─ PUT to Server API (online)&#10;│  └─ {latitude: 46.80, longitude: 23.65}&#10;└─ Update in Local Database&#10;   └─ UPDATE items SET latitude=?, longitude=? WHERE _id=?&#10;```&#10;&#10;## Key Components&#10;&#10;### 1. UI Layer (Jetpack Compose)&#10;- **ItemScreen**: Main form with all fields + map&#10;- **MyLocation**: Permission wrapper + location provider&#10;- **MyMap**: Interactive Google Map component&#10;&#10;### 2. ViewModel Layer&#10;- **ItemViewModel**: Manages item state and save logic&#10;- **MyLocationViewModel**: Manages location state&#10;&#10;### 3. Data Layer&#10;- **ItemRepository**: Handles data sync (server + local)&#10;- **ItemDao**: Room database operations&#10;- **ItemService**: Retrofit API calls&#10;&#10;### 4. Location Services&#10;- **LocationMonitor**: Wraps Google Location Services&#10;- **RequirePermissions**: Handles runtime permissions&#10;&#10;## Dependencies&#10;&#10;```&#10;maps-compose:4.3.3          → Google Maps Compose UI&#10;play-services-maps:18.2.0   → Google Maps SDK&#10;play-services-location:21.1.0 → Location Services&#10;accompanist-permissions:0.34.0 → Permission handling&#10;desugar_jdk_libs:2.0.4     → Java 8+ API backport&#10;```&#10;&#10;## Configuration&#10;&#10;```kotlin&#10;// build.gradle.kts&#10;isCoreLibraryDesugaringEnabled = true  // For Java Time API&#10;manifestPlaceholders[&quot;MAPS_API_KEY&quot;]   // For Google Maps&#10;&#10;// AndroidManifest.xml&#10;&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;&#10;&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;&#10;&lt;meta-data android:name=&quot;com.google.android.geo.API_KEY&quot; android:value=&quot;${MAPS_API_KEY}&quot; /&gt;&#10;&#10;// local.properties&#10;MAPS_API_KEY=AIzaSy...&#10;```&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>